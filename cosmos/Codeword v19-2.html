<!--1/3/2020 clearing dark selection on alpha choice resets number equivalent also
  click on grey alpha does nothing. Have to reject existing choice to make a new one 
  29/2/2020 Darkened selections working version v19-3.
  need to replace selected alphabit images with darkened versions so we know what we have used
  6/2/2020 fixed 'clear' to show fixed clues in matrix. moved buttons to top
  also made click on number without an alpha prior resets number - sort of 'undo'
  5/2/2020 want to have clear matrix always show the three given substitutions-done
   maybe need a checkbox to allow choice - retain all 'n' values or only the three initial
  4/2/2020 changed under chart numbers to clickable images by using innerHTML build
  3/2/2020 'new image' does not accept 'onclick'. To make that work,
  use innerHTML with prototype like "<img id='ii' src='images/black.png' onclick='showmatrix()'>;
  3/2/2020 trials of text data matrix from tabbed data
  2/1/2020 line and bar version with values-->
<!DOCTYPE=html>
<html>
<title> Cosmos Letter Puzzle</title>
<h2>Codeword Puzzle 'assistant' by Trevor. Acknowledgements -  
<a href="https://www.snodger.com.au"> Snodger Media </a>
<div class='buttons' align='left' >
<img src='images/showplot.png' onclick='chartfreqs()' >
<img src='images/showmatrix.png' onclick='showmatrix()' >
</div>
</h2>
<head>
<style>
   .buttons { 
        left: 15px;
        top: 100px;
        width:210px;
        background-color: #afafaf; 
      }
   .matrix{
      position:fixed;
      align:center;
      left: 200px;
      width:500px;
      top:450px;
     }
.div1{
     align: 'center'
}
.rectangle{
width:460px;height:460px;background:#eeeeff;
}
</style>
<div id='header' >
<div id='cnv' align='left'>
<canvas id='canvas' height='250'; width='780' style="border:2px solid black;"></canvas>
</div>
<div id='div1' align='left'></div>
<div id='matrix' </dv>

<script>
var clues="B,1";
var efreq="8.45,1.43,3.59,3.75,12.21,2.12,1.55,4.05,7.83,0.32,0.63,3.97,2.48,6.65,7.77,1.74,0.18,6.76,7.16,9.26,2.74,1.56,1.40,0.25,2.02,0.13";
var freq=[11,1,1,1,22,10,4,1,6,1,16,14,7,3,1,4,12,9,4,12,2,4,1,9,1,4];
var matrixdata="24	20	1	9	20	23	21	9	0	5	25	20	9	16	21	\
25	0	9	0	24	0	6	0	23	0	18	0	12	0	4	\
19	16	20	16	13	21	18	0	8	13	23	23	13	19	15	\
17	0	10	0	26	0	0	0	18	0	21	0	18	0	13	\
13	0	20	1	18	21	9	22	20	24	0	16	15	25	23	\
21	0	23	0	0	0	20	0	19	0	21	0	20	0	13	\
25	14	21	24	21	26	13	19	16	0	11	12	1	9	20	\
19	0	0	0	10	0	18	0	8	0	21	0	13	0	18	\
0	20	23	7	25	18	17	16	0	25	18	13	16	12	0	\
20	0	13	0	24	0	21	0	4	0	13	0	0	0	17	\
22	20	19	17	20	9	20	0	19	20	17	2	14	25	24	\
1	0	16	0	16	0	16	0	8	0	0	0	13	0	21	\
25	16	21	4	13	20	0	19	17	12	4	16	9	12	19	\
19	0	9	0	21	0	21	0	15	0	25	0	19	0	12	\
15	25	16	0	18	21	3	13	21	25	19	0	16	20	16";

const canvas=document.getElementById('canvas');
const context=canvas.getContext('2d');
context.fillStyle='blue';
var replace=0; // holds alpha id for num click replacement
var img=new Image(30,30);
var data=matrixdata.split("\t");// needs terminal tab to get all elements
var english=efreq.split(",");

chartfreqs();
showmatrix();

function showmatrix(){// shows data array, modified by clicks
var text="<div class='matrix'>";
var tc=0;
  for(i=0;i<data.length;i++){
   if(data[i]==0) text+="<img id='d"+i+"' src=images/black.png>";
      else 
    if(data[i]<27)text+="<img id='d"+i+"' src=images/"+data[i]+".png>";
             else text+="<img id='d"+i+"' src=images/alphabit"+data[i]+".png>";//show fixed clue
    if((i%15)==14)text+="<br>";
  } 
  //  text="<div class='content' align='left' ><img src=images/showplot.png onclick='chartfreqs()' ><img  src='images/showmatrix.png' onclick='showmatrix()' ></div>"+text;
    document.getElementById('matrix').innerHTML=text;
    for(i=1;i<27;i++)document.getElementById('n'+i).src="images/"+i+".png";//on show matrix reset number line
    showclues();
}

function showclues(){//place the given clues as alpha on the number line
var c=clues.split(",");
for(i=1;i<26;i++){
  for(cl=0;cl<c.length;cl+=2)if(i==c[cl+1])document.getElementById('n'+i).src="images/alphabit"+c[cl]+".png";//replace number line element by alpha clue
  }
  for(i=1;i<data.length;i++){
    for(cl=0;cl<c.length;cl+=2)if(data[i]==c[cl+1])data[i]=c[cl];//replace data element by alpha clue (9 becomes "M")
  }
}

function drawBar(ctx, upperLeftCornerX, upperLeftCornerY, width, height,color){
    ctx.save();
    ctx.fillStyle=color;
    ctx.fillRect(upperLeftCornerX,upperLeftCornerY,width,height);
    ctx.restore();
}
function calcfreqs(){
for(i=0;i<26;i++)freq[i]=0;
for(i=0;i<data.length;i++) if(data[i]!=0)freq[parseInt(data[i])-1]+=1;
}

function chartfreqs(){
var textnums="";
var textalphs="";
var c=clues.split(",");
calcfreqs();
context.lineWidth=2;
context.beginPath();context.moveTo(5,255-5*freq[0]);
for(i=0;i<freq.length;i++){
context.lineTo(17+(i)*30,255-5*freq[i]);
//img=new Image(30,30);
//img.id='i+1';img.src=images/i+1+'.png';
drawBar(context,3+i*30,255-5*freq[i],30,5*freq[i],'#CCCCDD');
context.font = "bold 15px Arial";
context.fillStyle="#0000ff";
context.fillText(freq[i],12+i*30,250-5*freq[i]);
//document.getElementById('div1').appendChild(img);//add <img 1-26> in javascript not provide 'onclick' with new images
 textnums+="<img id='n"+(i+1)+"' src='images/"+(i+1)+".png' onclick='nclick("+(i+1)+")' >";
 var source="alphabit"+String.fromCharCode(65+i)+".png";
 textalphs+="<img id='a"+(i+1)+"' src='images/"+source+"' onclick='aclick("+(i+1)+")' >";
 context.stroke();
 }
document.getElementById('div1').innerHTML=textnums+"<br>"+textalphs;
// now plot english comparison data
context.beginPath();context.moveTo(5,100-5*english[0]);
context.fillStyle="#ffaaaa";
context.strokeStyle="#ffaaaa";
context.fillText("English frequencies A-Z %",5,20);
context.fillStyle="#0000ff";
context.fillText("This matrix",5,135);
context.fillStyle="#ffaaaa";
for(i=0;i<english.length;i++){
context.lineTo(15+(i)*30,100-5*english[i]);
context.fillText(String.fromCharCode(i+65),5+i*30,100);
}
context.moveTo(5,105);context.lineTo(canvas.width,105);
context.stroke();
showclues();
}

function nclick(){//click on number in row - replace image with alpha choice

     {
    var tmp=(document.getElementById('n'+arguments[0]).src);
    tmp=tmp.charAt(tmp.length-5);                      //n line 9 may be X, so we want to replace a line 'x'-64
    if(intFromAlpha(tmp)>64){ // there was an alpha image at the clicked point, so do the reset things. Avoids error in unset case
    tmp=intFromAlpha(tmp)-64;   //gets ordinal position
    document.getElementById('a'+tmp).src="images/alphabit"+String.fromCharCode(64+tmp)+".png";//restore alpha image in alpha line at ordinal
    document.getElementById('n'+arguments[0]).src="images/"+arguments[0]+".png";//reset number line
    for(i=0;i<data.length;i++)
    if(data[i]==arguments[0])document.getElementById('d'+i).src="images/"+arguments[0]+".png";//reset matrix
    }
  }
if(replace!=0){
 document.getElementById('n'+arguments[0]).src="images/alphabit"+String.fromCharCode(64+replace)+".png";
 for(i=0;i<data.length;i++) //replace matrix element with alpha
    if(data[i]==arguments[0])document.getElementById('d'+i).src="images/alphabit"+String.fromCharCode(64+replace)+".png";
  }
  replace=0;
 }
// homebrew function to enable backtrack from alpha name to ordinal in alpha choice line
function intFromAlpha(alpha){
var ret;
for(i=64;i<91;i++)
if(alpha==String.fromCharCode(i))ret=i;
return ret;
}

function aclick(){//click on alpha in row - set id for num to use as replacement
 replace=arguments[0];
 var tmp=document.getElementById('a'+arguments[0]).src; tmp=tmp.substring(tmp.length-18,tmp.length-14);
//tmp is "dark" if previously clicked
if(tmp=="dark") replace=0; //stays dark until numeric reset.
 else 
 document.getElementById('a'+arguments[0]).src="images/dark/alphabit"+String.fromCharCode(64+arguments[0])+".png";
}

</script>
</head>
<body>
<h2>You are given a clue letter to start with B-1
<div class='rectangle'></div>
</body>
</html> 
